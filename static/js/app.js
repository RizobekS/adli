(()=>{function K(){let e=document.getElementById("panelSidebar"),n=document.getElementById("panelSidebarToggle");if(!e||e.dataset.bound==="1")return;e.dataset.bound="1";let t="adli_sidebar_collapsed",s="w-72",i="w-20",o=()=>e.querySelectorAll(".sidebar-label"),d=0,p=null,u=()=>{o().forEach(a=>{a.classList.add("hidden"),a.classList.remove("opacity-100"),a.classList.add("opacity-0")})},y=()=>{o().forEach(a=>{a.classList.remove("hidden"),a.classList.remove("opacity-0"),a.classList.add("opacity-100")})},q=(a,f)=>{let w=a.dataset.accordionTarget,_=document.getElementById(w);_&&(a.setAttribute("aria-expanded",f?"true":"false"),f?(_.classList.remove("max-h-0","opacity-0"),_.classList.add("max-h-96","opacity-100")):(_.classList.remove("max-h-96","opacity-100"),_.classList.add("max-h-0","opacity-0")))};e.querySelectorAll("[data-accordion-trigger]").forEach(a=>{a.dataset.bound!=="1"&&(a.dataset.bound="1",a.addEventListener("click",()=>{if(localStorage.getItem(t)==="1")return;let w=a.getAttribute("aria-expanded")==="true";q(a,!w)}))}),o().forEach(a=>a.classList.add("transition-opacity","duration-200"));let v=a=>{document.documentElement.style.setProperty("--sidebar-w",a?"5rem":"18rem"),document.documentElement.dataset.sidebarCollapsed=a?"1":"0"},h=a=>{e.classList.toggle(s,!a),e.classList.toggle(i,a)},B=()=>{p&&(clearTimeout(p),p=null)},L=()=>{d+=1;let a=d;B(),h(!1),v(!1);let f=w=>{w.propertyName==="width"&&(e.removeEventListener("transitionend",f),a===d&&y())};e.addEventListener("transitionend",f),p=setTimeout(()=>{a===d&&y()},320)},C=()=>{d+=1,B(),u(),h(!0),v(!0),e.querySelectorAll("[data-accordion-trigger]").forEach(a=>{q(a,!1)})},S=a=>{a?C():L()},l=localStorage.getItem(t)==="1";S(l),n&&!n.dataset.bound&&(n.dataset.bound="1",n.addEventListener("click",()=>{let f=!(localStorage.getItem(t)==="1");localStorage.setItem(t,f?"1":"0"),S(f)})),e.addEventListener("mouseenter",()=>{localStorage.getItem(t)==="1"&&L()}),e.addEventListener("mouseleave",()=>{localStorage.getItem(t)==="1"&&C()})}function G(){let e=document.getElementById("panelMobileOpen"),n=document.getElementById("panelMobileClose"),t=document.getElementById("panelMobileSidebar"),s=document.getElementById("panelMobileBackdrop");if(!e||!n||!t||!s||e.dataset.bound==="1")return;e.dataset.bound="1";let i=!1,o=()=>{i||(i=!0,s.classList.remove("pointer-events-none"),t.classList.remove("pointer-events-none"),s.classList.remove("opacity-0"),s.classList.add("opacity-100"),t.classList.remove("-translate-x-full","opacity-0"),t.classList.add("translate-x-0","opacity-100"))},d=()=>{i&&(i=!1,s.classList.remove("opacity-100"),s.classList.add("opacity-0"),t.classList.remove("translate-x-0","opacity-100"),t.classList.add("-translate-x-full","opacity-0"),document.querySelectorAll("[data-m-accordion-trigger]").forEach(u=>p(u,!1)),setTimeout(()=>{i||(s.classList.add("pointer-events-none"),t.classList.add("pointer-events-none"))},220))};t.dataset.closeFn="1",window.__adliCloseMobileSidebar=d,e.addEventListener("click",o),n.addEventListener("click",d),s.addEventListener("click",d),document.body.dataset.mobileEscBound||(document.body.dataset.mobileEscBound="1",document.addEventListener("keydown",u=>{u.key==="Escape"&&typeof window.__adliCloseMobileSidebar=="function"&&window.__adliCloseMobileSidebar()}));let p=(u,y)=>{let q=u.dataset.mAccordionTarget,E=document.getElementById(q);E&&(u.setAttribute("aria-expanded",y?"true":"false"),y?(E.classList.remove("max-h-0","opacity-0"),E.classList.add("max-h-96","opacity-100")):(E.classList.remove("max-h-96","opacity-100"),E.classList.add("max-h-0","opacity-0")))};document.querySelectorAll("[data-m-accordion-trigger]").forEach(u=>{u.dataset.bound!=="1"&&(u.dataset.bound="1",u.addEventListener("click",()=>{let y=u.getAttribute("aria-expanded")==="true";p(u,!y)}))})}function F(){let e=document.body.dataset.notSelected||"\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D",n=document.getElementById("depAsstInput"),t=document.getElementById("depAsstSearch"),s=document.getElementById("depAsstList"),i=document.getElementById("sendForResolutionBtn");function o(){i&&(i.disabled=!(n&&n.value))}function d(){s&&s.querySelectorAll(".dep-asst-check").forEach(l=>l.classList.add("hidden"))}function p(l){d();let a=l.querySelector(".dep-asst-check");a&&a.classList.remove("hidden")}s&&s.dataset.bound!=="1"&&(s.dataset.bound="1",s.addEventListener("click",l=>{let a=l.target.closest("[data-dep-asst-id]");if(!a)return;let f=a.dataset.depAsstId||"";n&&(n.value=f),p(a),o(),l.preventDefault(),l.stopPropagation()})),t&&t.dataset.bound!=="1"&&(t.dataset.bound="1",t.addEventListener("input",()=>{let l=t.value.trim().toLowerCase();s?.querySelectorAll(".dep-asst-item").forEach(a=>{let f=a.getAttribute("data-name")||"";a.style.display=f.includes(l)?"":"none"})})),o();let u=document.getElementById("id_target_department"),y=document.getElementById("id_target_employee"),q=document.getElementById("depLabel"),E=document.getElementById("empLabel"),v=document.getElementById("empSearch"),h=document.getElementById("empList");if(!!!(u&&y&&q&&E&&h))return;function L(l,a){l.value=a,l.dispatchEvent(new Event("change",{bubbles:!0}))}function C(l){h.querySelectorAll(".emp-item").forEach(a=>{let f=a.getAttribute("data-dep")||"";a.style.display=!l||f===l?"":"none"})}function S(l){let a=document.getElementById(l);a&&a.classList.add("hidden")}document.body.dataset.resDropBound||(document.body.dataset.resDropBound="1",document.addEventListener("click",l=>{let a=document.getElementById("depMenu"),f=document.getElementById("empMenu");a&&!l.target.closest("#depMenu")&&!l.target.closest("#depBtn")&&a.classList.add("hidden"),f&&!l.target.closest("#empMenu")&&!l.target.closest("#empBtn")&&f.classList.add("hidden");let w=l.target.closest("button[data-set]");if(!w)return;let _=w.dataset.set,I=w.dataset.id||"",A=w.dataset.label||"";if(_==="dep"){L(u,I),q.textContent=A||e,L(y,""),E.textContent=e,C(I),S("depMenu");return}if(_==="emp"){let H=u.value||"",M=w.dataset.dep||"";if(H&&M&&H!==M)return;L(y,I),E.textContent=A||e,S("empMenu")}},{capture:!0})),C(u.value||""),v&&v.dataset.bound!=="1"&&(v.dataset.bound="1",v.addEventListener("input",()=>{let l=v.value.trim().toLowerCase();h.querySelectorAll(".emp-item").forEach(a=>{let f=a.getAttribute("data-name")||"";a.style.display=f.includes(l)?"":"none"})}))}function U(){document.querySelectorAll('input[type="date"]').forEach(e=>{if(e.dataset.dateBound==="1")return;e.dataset.dateBound="1";let n=0,t=()=>{let s=Date.now();s-n<180||(n=s,typeof e.showPicker=="function"?e.showPicker():e.focus())};e.addEventListener("click",t),e.addEventListener("focus",t)})}function X(){let e=document.getElementById("toast-stack");if(!e)return;let n=e.querySelectorAll(".adli-toast:not([data-init='1'])");function t(i){requestAnimationFrame(()=>{i.classList.remove("opacity-0","translate-x-8"),i.classList.add("opacity-100","translate-x-0")})}function s(i){i.classList.remove("opacity-100","translate-x-0"),i.classList.add("opacity-0","translate-x-8"),setTimeout(()=>i.remove(),320)}n.forEach(i=>{i.dataset.init="1",t(i);let o=i.querySelector(".adli-toast-close");o&&!o.dataset.bound&&(o.dataset.bound="1",o.addEventListener("click",()=>s(i)));let d=parseInt(i.dataset.delay||"4500",10);setTimeout(()=>s(i),d)})}function R(e,n=""){return window.DASH_I18N&&window.DASH_I18N[e]||n}function J(e){let n=e?.values||[];return n.length?n.every(t=>!t||Number(t)===0):!0}function te(e,n){let t=document.getElementById(e);if(t){try{let s=echarts.getInstanceByDom(t);s&&s.dispose()}catch{}t.innerHTML=`
    <div class="h-full w-full flex items-center justify-center text-sm text-gray-500">
      ${n}
    </div>
  `}}function ne(e,n){let t=document.querySelector(`[data-chart-error="${e}"]`);t&&(t.textContent=n,t.classList.remove("hidden"))}function se(e){let n=document.querySelector(`[data-chart-error="${e}"]`);n&&(n.classList.add("hidden"),n.textContent="")}function ae(e){e.querySelectorAll(".dash-card").forEach((t,s)=>{t.style.opacity="0",t.style.transform="translateY(8px)",t.style.transition="opacity 260ms ease, transform 260ms ease",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},40+s*40)})}function O(e){let n=document.getElementById(e);if(!n)return null;try{let t=echarts.getInstanceByDom(n);t&&t.dispose()}catch{}return echarts.init(n)}function ie(e){let n=()=>{e.forEach(t=>t&&t.resize())};if(window.addEventListener("resize",n),window.ResizeObserver){let t=new ResizeObserver(()=>n());e.forEach(s=>{s&&t.observe(s.getDom())})}}function oe(e){if(!e)return;let n=(t,s)=>{let i=document.getElementById(t);i&&(i.textContent=s??"0")};n("kpiRequestsTotal",e.requests?.total),n("kpiRequestsNew",e.requests?.new),n("kpiRequestsInProgress",e.requests?.in_progress),n("kpiRequestsOverdue",e.requests?.overdue),n("kpiRequestsDoneToday",e.requests?.done_today),n("kpiCompaniesTotal",e.companies?.total),n("kpiCompaniesWithRegion",e.companies?.with_region),n("kpiCompaniesWithoutRegion",e.companies?.without_region),n("kpiCompaniesWithoutCategory",e.companies?.without_category),n("kpiCompaniesWithoutDirections",e.companies?.without_directions)}function re(e,n){let t=O(e);if(!t)return null;let s=n?.series||[];return t.setOption({tooltip:{trigger:"item"},legend:{top:"bottom"},series:[{name:"status",type:"pie",radius:["45%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:6,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:12,fontWeight:"bold"}},labelLine:{show:!1},data:s,animationDuration:700,animationEasing:"cubicOut"}]}),t}function ce(e,n,t){let s=O(e);return s?(s.setOption({tooltip:{trigger:"item"},legend:{top:"bottom"},series:[{name:n,type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:6,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:12,fontWeight:"bold"}},labelLine:{show:!1},data:t,animationDuration:700,animationEasing:"cubicOut"}]}),s):null}function Z(e,n,t={}){let s=O(e);if(!s)return null;let i=n?.labels||[],o=n?.values||[];return s.setOption({tooltip:{trigger:"axis"},grid:{left:24,right:16,top:16,bottom:48,containLabel:!0},xAxis:{type:"category",data:i,axisLabel:{rotate:t.rotateLabels?25:0}},yAxis:{type:"value"},series:[{type:"bar",data:o,animationDuration:700,animationEasing:"cubicOut"}]}),s}function W(e,n){let t=O(e);if(!t)return null;let s=n?.labels||[],i=n?.values||[];return t.setOption({tooltip:{trigger:"axis"},grid:{left:24,right:16,top:16,bottom:16,containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:s,axisLabel:{width:200,overflow:"break",lineHeight:14}},series:[{type:"bar",data:i,animationDuration:700,animationEasing:"cubicOut"}]}),t}function de(e,n,t){let s=O(e);if(!s)return null;let i=n?.labels||[],o=n?.values||[],d=t?.values||[];return s.setOption({tooltip:{trigger:"axis"},legend:{top:8},grid:{left:24,right:16,top:36,bottom:48,containLabel:!0},xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[{name:R("created","\u0421\u043E\u0437\u0434\u0430\u043D\u043E"),type:"line",data:o,smooth:!0,animationDuration:700,animationEasing:"cubicOut"},{name:R("closed","\u0417\u0430\u043A\u0440\u044B\u0442\u043E"),type:"line",data:d,smooth:!0,animationDuration:700,animationEasing:"cubicOut"}]}),s}async function le(e){let n=await fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}function j(){let e=document.getElementById("dashboardRoot");if(!e)return;let n=e.dataset.dashboardUrl;if(!n)return;let t=document.getElementById("dashboardRefreshBtn"),s=[],i=async()=>{try{let o=await le(n);oe(o.kpi),J(o.sla_overdue_by_department)?te("chartSlaOverdueDepartments",R("no_overdue","\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043D\u044B\u0445 \u0437\u0430\u044F\u0432\u043E\u043A \u043D\u0435\u0442")):W("chartSlaOverdueDepartments",o.sla_overdue_by_department),["chartRequestsStatus","chartRequestsDirections","chartRequestsRegions","chartRequestsTimeline","chartSlaOverdueDepartments","chartCompaniesCategories","chartCompaniesRegions","chartDataQuality"].forEach(se);let d=re("chartRequestsStatus",o.requests_by_status),p=Z("chartRequestsDirections",o.requests_by_direction,{rotateLabels:!0}),u=W("chartRequestsRegions",o.requests_by_region),y=de("chartRequestsTimeline",o.requests_timeline_created,o.requests_timeline_done),q=J(o.sla_overdue_by_department)?null:W("chartSlaOverdueDepartments",o.sla_overdue_by_department),E=Z("chartCompaniesCategories",o.companies_by_category,{rotateLabels:!0}),v=W("chartCompaniesRegions",o.companies_by_region),h=o.data_quality||{},B=h.total||0,L=Math.max(0,B-(h.missing_region||0)-(h.missing_district||0)-(h.missing_category||0)),C=[{name:R("dq_no_region","\u0411\u0435\u0437 \u0440\u0435\u0433\u0438\u043E\u043D\u0430"),value:h.missing_region||0},{name:R("dq_no_district","\u0411\u0435\u0437 \u0440\u0430\u0439\u043E\u043D\u0430"),value:h.missing_district||0},{name:R("dq_no_category","\u0411\u0435\u0437 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438"),value:h.missing_category||0},{name:R("dq_no_directions","\u0411\u0435\u0437 \u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0439"),value:h.missing_directions||0}],S=ce("chartDataQuality",R("dq_title","\u041A\u0430\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u0430\u043D\u043D\u044B\u0445"),C);s=[d,p,u,y,q,E,v,S].filter(Boolean),ie(s),ae(e)}catch(o){let d="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0430\u043D\u0430\u043B\u0438\u0442\u0438\u043A\u0443.";["chartRequestsStatus","chartRequestsDirections","chartRequestsRegions","chartRequestsTimeline","chartSlaOverdueDepartments","chartCompaniesCategories","chartCompaniesRegions","chartDataQuality"].forEach(p=>ne(p,d)),console.error("[dashboard] load failed:",o)}};t&&t.addEventListener("click",i),i()}function V(){let e=document.querySelector('form[data-public-request-form="1"]');if(!e)return;let n=document.getElementById("id_category"),t=document.getElementById("id_region"),s=document.getElementById("id_district"),i=document.getElementById("id_directions");if(!n||!t||!s||!i)return;let o=document.getElementById("reqRegionLabel"),d=document.getElementById("reqDistrictBtn"),p=document.getElementById("reqDistrictLabel"),u=document.getElementById("reqDistrictHint"),y=document.getElementById("reqDistrictList"),q=document.getElementById("reqDistrictSearch"),E=document.getElementById("reqCategoryLabel"),v=document.getElementById("reqDirectionsBtn"),h=document.getElementById("reqDirectionsLabel"),B=document.getElementById("reqDirectionsMenu"),L=document.getElementById("reqDirectionsList"),C=document.getElementById("reqDirectionsSearch"),S=document.getElementById("reqDirectionsHint"),l=document.getElementById("reqDirectionsChips"),a=document.getElementById("reqDirectionsClear"),f=document.getElementById("reqDirectionsDone"),w=e.dataset.districtsUrl,_=e.dataset.directionsUrl;function I(r){return String(r??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function A(r){let c=document.getElementById(r);c&&c.classList.add("hidden")}function H(){document.querySelectorAll("[data-dropdown-toggle]").forEach(r=>{let c=r.getAttribute("data-dropdown-toggle");c&&A(c)}),B&&B.classList.add("hidden")}document.addEventListener("keydown",r=>{r.key==="Escape"&&H()});async function M(r){if(y.innerHTML="",!r){d.disabled=!0,y.innerHTML='<li class="px-3 py-2 text-gray-500">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0433\u0438\u043E\u043D</li>';return}d.disabled=!1,u&&u.classList.add("hidden"),y.innerHTML='<li class="px-3 py-2 text-gray-500">\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...</li>';let c=`${w}?region_id=${encodeURIComponent(r)}`,D=(await(await fetch(c,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).results||[];s.innerHTML="";let g=document.createElement("option");if(g.value="",g.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0439\u043E\u043D/\u0433\u043E\u0440\u043E\u0434",s.appendChild(g),D.forEach(x=>{let T=document.createElement("option");T.value=String(x.id),T.textContent=x.name,s.appendChild(T)}),!D.length){y.innerHTML='<li class="px-3 py-2 text-gray-500">\u041D\u0435\u0442 \u0440\u0430\u0439\u043E\u043D\u043E\u0432</li>';return}y.innerHTML=`<li>
        <button type="button" class="w-full px-3 py-2 text-left hover:bg-gray-50"
                data-set="req-district" data-id="" data-label="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0439\u043E\u043D/\u0433\u043E\u0440\u043E\u0434">
          \u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E
        </button>
      </li>`+D.map(x=>`
          <li class="req-district-item" data-name="${I((x.name||"").toLowerCase())}">
            <button type="button" class="w-full px-3 py-2 text-left hover:bg-gray-50"
                    data-set="req-district" data-id="${x.id}" data-label="${I(x.name)}">
              ${I(x.name)}
            </button>
          </li>`).join("")}d&&d.addEventListener("click",r=>{t.value||(r.preventDefault(),u&&(u.classList.remove("hidden"),setTimeout(()=>u.classList.add("hidden"),2500)),A("reqDistrictMenu"))}),q&&q.addEventListener("input",()=>{let r=q.value.trim().toLowerCase();y.querySelectorAll(".req-district-item").forEach(c=>{let m=c.dataset.name||"";c.style.display=m.includes(r)?"":"none"})});function k(){return Array.from(i.selectedOptions).map(r=>r.value)}function Y(){if(!L)return;let r=new Set(k().map(String));L.querySelectorAll("input[data-dir-id]").forEach(c=>{let m=c.getAttribute("data-dir-id");c.checked=r.has(String(m))})}function z(r){let c=new Set(r.map(String));Array.from(i.options).forEach(m=>{m.selected=c.has(m.value)}),i.dispatchEvent(new Event("change",{bubbles:!0})),$(),P(),Y()}function P(){let r=k();if(!r.length){h.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F";return}h.textContent=`\u0412\u044B\u0431\u0440\u0430\u043D\u043E: ${r.length}`}function $(){l.innerHTML="",Array.from(i.selectedOptions).map(c=>({id:c.value,title:c.textContent})).forEach(c=>{let m=document.createElement("button");m.type="button",m.className="inline-flex items-center gap-2 rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-sm text-blue-800 hover:bg-blue-100",m.innerHTML=`<span>${I(c.title)}</span><span class="text-blue-600">\u2715</span>`,m.addEventListener("click",()=>{let b=k().filter(D=>D!==String(c.id));z(b)}),l.appendChild(m)})}function ee(r){let c=new Set(k());i.innerHTML="",r.forEach(g=>{let x=document.createElement("option");x.value=String(g.id),x.textContent=g.title,i.appendChild(x)});let m=new Set(r.map(g=>String(g.id)));if(Array.from(c).filter(g=>m.has(String(g))).forEach(g=>{let x=Array.from(i.options).find(T=>T.value===String(g));x&&(x.selected=!0)}),!r.length){L.innerHTML='<li class="px-3 py-2 text-gray-500">\u041D\u0435\u0442 \u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0439</li>',$(),P(),Y();return}let D=new Set(k());L.innerHTML=r.map(g=>`
        <li class="direction-item" data-name="${I((g.title||"").toLowerCase())}">
          <label class="flex items-center gap-3 px-3 py-2 hover:bg-gray-50 cursor-pointer">
            <input type="checkbox" class="h-4 w-4" data-dir-id="${g.id}" ${D.has(String(g.id))?"checked":""}>
            <span class="text-sm text-gray-800">${I(g.title)}</span>
          </label>
        </li>`).join(""),$(),P()}async function N(r){if(!r){v.disabled=!0,L.innerHTML='<li class="px-3 py-2 text-gray-500">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E</li>',i.innerHTML="",$(),P();return}v.disabled=!1,S&&S.classList.add("hidden"),L.innerHTML='<li class="px-3 py-2 text-gray-500">\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...</li>';let c=`${_}?category=${encodeURIComponent(r)}`,b=await(await fetch(c,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();ee(b.results||[])}v&&v.addEventListener("click",r=>{if(v.disabled){r.preventDefault(),S&&(S.classList.remove("hidden"),setTimeout(()=>S.classList.add("hidden"),2500)),B.classList.add("hidden");return}B.classList.toggle("hidden")}),C&&C.addEventListener("input",()=>{let r=C.value.trim().toLowerCase();L.querySelectorAll(".direction-item").forEach(c=>{let m=c.dataset.name||"";c.style.display=m.includes(r)?"":"none"})}),a&&a.addEventListener("click",()=>z([])),f&&f.addEventListener("click",()=>B.classList.add("hidden")),document.addEventListener("click",r=>{let c=r.target.closest("input[data-dir-id]");if(c){let m=c.getAttribute("data-dir-id"),b=new Set(k());c.checked?b.add(String(m)):b.delete(String(m)),z(Array.from(b));return}}),document.addEventListener("click",async r=>{let c=r.target.closest("button[data-set]");if(!c)return;let m=c.dataset.set,b=c.dataset.id||"",D=c.dataset.label||"";if(m==="req-region"){t.value=b,o&&(o.textContent=D||"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0433\u0438\u043E\u043D"),s.value="",p&&(p.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0439\u043E\u043D/\u0433\u043E\u0440\u043E\u0434"),await M(b),t.dispatchEvent(new Event("change",{bubbles:!0})),A("reqRegionMenu");return}if(m==="req-district"){if(b&&!Array.from(s.options).some(g=>g.value===String(b))){let g=document.createElement("option");g.value=String(b),g.textContent=D,s.appendChild(g)}s.value=String(b),p&&(p.textContent=D||"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0439\u043E\u043D/\u0433\u043E\u0440\u043E\u0434"),s.dispatchEvent(new Event("change",{bubbles:!0})),A("reqDistrictMenu");return}if(m==="req-category"){n.value=b,E&&(E.textContent=D||"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E"),n.dispatchEvent(new Event("change",{bubbles:!0})),A("reqCategoryMenu"),await N(b);return}}),document.addEventListener("click",r=>{!r.target.closest("#reqDirectionsMenu")&&!r.target.closest("#reqDirectionsBtn")&&B?.classList.add("hidden")}),t.value&&M(t.value),n.value?N(n.value):N("")}function Q(){let e=document.getElementById("attachments-container"),n=document.getElementById("add-attachment");if(!e||!n)return;function t(o){o.addEventListener("click",()=>{o.closest(".flex")?.remove(),s()})}function s(){let o=e.querySelectorAll(".flex");if(!o.length)return;let d=o[0].querySelector(".remove-attachment");d&&(o.length===1?d.classList.add("hidden"):d.classList.remove("hidden"))}let i=e.querySelector(".remove-attachment");i&&t(i),n.addEventListener("click",()=>{let o=document.createElement("div");o.className="flex gap-2";let d=document.createElement("input");d.type="file",d.name="attachments",d.accept=".pdf,.doc,.docx,.xls,.xlsx",d.className="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer p-2 bg-gray-50";let p=document.createElement("button");p.type="button",p.className="remove-attachment shrink-0 rounded-lg border border-gray-300 bg-white px-3 text-sm hover:bg-gray-50",p.textContent="\u2715",t(p),o.appendChild(d),o.appendChild(p),e.appendChild(o),s()}),s()}function ue(){K(),G(),F(),U(),X(),j(),V(),Q()}document.addEventListener("DOMContentLoaded",ue);document.body.addEventListener("htmx:afterSwap",()=>{F(),U(),X(),j(),V(),Q()});})();
